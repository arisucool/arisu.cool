"use strict";(self.webpackChunkarisucool=self.webpackChunkarisucool||[]).push([[334],{1334:(nt,y,l)=>{l.r(y),l.d(y,{GoodsListModule:()=>et});var p=l(6895),C=l(8996);function v(n,s,e,o,r,a,u){try{var i=n[a](u),c=i.value}catch(m){return void e(m)}i.done?s(c):Promise.resolve(c).then(o,r)}function d(n){return function(){var s=this,e=arguments;return new Promise(function(o,r){var a=n.apply(s,e);function u(c){v(a,o,r,u,i,"next",c)}function i(c){v(a,o,r,u,i,"throw",c)}u(void 0)})}}var t=l(4650);function P(n,s){if(!n)throw new Error(s)}const b=function(){var n=d(function*(s,e,o){return new Promise((r,a)=>{const c=s.transaction(e,"readonly").objectStore(e).count(String(o));c.onsuccess=()=>{r(0!==c.result)},c.onerror=()=>{a(c.error)}})});return function(e,o,r){return n.apply(this,arguments)}}(),w=function(){var n=d(function*(s,e,o,r){if(void 0!==r)return new Promise((a,u)=>{const i=s.transaction(e,"readwrite"),m=i.objectStore(e).put(r,String(o));i.oncomplete=()=>{a()},i.onabort=()=>{u(m.error?m.error:i.error)},i.onerror=()=>{u(m.error?m.error:i.error)}});yield S(s,e,o)});return function(e,o,r,a){return n.apply(this,arguments)}}(),S=function(){var n=d(function*(s,e,o){return new Promise((r,a)=>{const u=s.transaction(e,"readwrite"),c=u.objectStore(e).delete(String(o));u.oncomplete=()=>{r()},u.onabort=()=>{a(c.error?c.error:u.error)},u.onerror=()=>{a(c.error?c.error:u.error)}})});return function(e,o,r){return n.apply(this,arguments)}}(),L=function(){var n=d(function*(s,e){return new Promise((o,r)=>{const a=s.transaction(e,"readwrite"),i=a.objectStore(e).clear();a.oncomplete=()=>{o()},a.onabort=()=>{r(i.error?i.error:a.error)},a.onerror=()=>{r(i.error?i.error:a.error)}})});return function(e,o){return n.apply(this,arguments)}}(),O=({database:n,databaseName:s,tableName:e})=>{const o={delete:r=>S(n,e,r).then(()=>!0),get:r=>((n,s,e)=>new Promise((o,r)=>{const i=n.transaction(s,"readonly").objectStore(s).get(String(e));i.onsuccess=()=>{o(i.result)},i.onerror=()=>{r(i.error)}}))(n,e,r),has:r=>b(n,e,r),set:(r,a)=>w(n,e,r,a).then(()=>o),clear:()=>L(n,e),dropInstance:()=>((n,s)=>new Promise((e,o)=>{n.close();const r=indexedDB.deleteDatabase(s);r.onupgradeneeded=a=>{a.preventDefault(),e()},r.onblocked=()=>{o(r.error)},r.onerror=function(){o(r.error)},r.onsuccess=function(){e()}}))(n,s),close:()=>Promise.resolve().then(()=>{n.close()}),[Symbol.asyncIterator]:()=>((n,s)=>{const a=n.transaction(s,"readonly").objectStore(s).openCursor();return{next:()=>d(function*(){const{done:u,value:i}=yield(u=>new Promise((i,c)=>{u.onsuccess=()=>{const m=u.result;return i(m?{done:!1,value:m}:{done:!0})},u.onerror=()=>{c(u.error)}}))(a);if(!u){const c=i?.key,m=i?.value;return i?.continue(),{done:!1,value:[c,m]}}return{done:!0,value:void 0}})()}})(n,e),__debug__database__:n};return o},x=function(){var n=d(function*(s){var e;const{name:o,version:r,upgrade:a,...u}=s;P("string"==typeof o,"name should be string"),P("number"==typeof r,"version should be number");const i=null!==(e=u.tableName)&&void 0!==e?e:"kvs",c=yield(({name:n,version:s,tableName:e,onUpgrade:o})=>new Promise((r,a)=>{const u=indexedDB.open(n,s);u.onupgradeneeded=function(i){var c;const m=i.oldVersion,_=null!==(c=i.newVersion)&&void 0!==c?c:s,g=u.result;try{(!_||_<=1)&&g.createObjectStore(e)}catch(h){a(h)}g.onversionchange=()=>{g.close()},i.target.transaction.oncomplete=d(function*(){try{return yield o({oldVersion:m,newVersion:_,database:g}),r(g)}catch(h){return a(h)}})},u.onblocked=()=>{a(u.error)},u.onerror=function(){a(u.error)},u.onsuccess=function(){r(u.result)}}))({name:o,version:r,tableName:i,onUpgrade:({oldVersion:m,newVersion:_,database:g})=>{if(a)return a({kvs:O({database:g,tableName:i,databaseName:o}),oldVersion:m,newVersion:_})}});return O({database:c,tableName:i,databaseName:o})});return function(e){return n.apply(this,arguments)}}();let F=(()=>{class n{constructor(){this.CACHE_STORAGE_VERSION=1}init(){var e=this;return d(function*(){e.storage||(e.storage=yield x({name:"arisucoolCache",version:e.CACHE_STORAGE_VERSION}))})()}getCachedJson(e,o){var r=this;return d(function*(){if(yield r.init(),!r.storage)throw new Error("Storage not initialized");const a=yield r.storage.get(e);if(null===a)return;let u;try{u=JSON.parse(a)}catch{return}if(!u||!u.content||!u.createdAt)return;const i=(new Date).getTime();if(!(void 0!==o&&o<i-u.createdAt))return u.content;r.storage.delete(e)})()}setCachedJson(e,o){var r=this;return d(function*(){if(yield r.init(),!r.storage)throw new Error("Storage not initialized");const a=(new Date).getTime();"string"==typeof o&&(o=JSON.parse(o)),r.storage.set(e,JSON.stringify({content:o,createdAt:a}))})()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),G=(()=>{class n{constructor(e){this.appCacheService=e,this.GOODS_LIST_STORAGE_VERSION=1}init(){var e=this;return d(function*(){e.storage||(e.storage=yield x({name:"arisucoolGoodsListItemStatus",version:e.GOODS_LIST_STORAGE_VERSION}))})()}getGoodsList(){var e=this;return d(function*(){yield e.init();const o=yield e.appCacheService.getCachedJson("arisuGoodsList",n.GOODS_LIST_JSON_CACHE_EXPIRES);if(o)return yield e.injectStatuses(o);const r=yield fetch("https://script.google.com/macros/s/AKfycbxG8BUqph9H7kmUqA5hGBxWwENfySVfdQBjtuZJQWLhCuC7wYYG1d0Hmc-jGrFUwBvWbg/exec");if(!r.ok)throw new Error("Failed to fetch goods list");const a=yield r.json();let u=[];for(const i of a){const c=n.getValueByMatchedKey(i,"id");!c||isNaN(c)||u.push({id:parseInt(c,10),category:n.getValueByMatchedKey(i,"\u30ab\u30c6\u30b4\u30ea"),maker:n.getValueByMatchedKey(i,"\u30e1\u30fc\u30ab\u30fc"),reservationStartDate:n.getValueByMatchedKey(i,"\u4e88\u7d04\u958b\u59cb\u65e5"),name:n.getValueByMatchedKey(i,"\u5546\u54c1\u540d"),isArisuAlone:n.getValueByMatchedKey(i,"\u3042\u308a\u3059\u5358\u72ec\u304b"),releaseDate:n.getValueByMatchedKey(i,"\u767a\u58f2\u65e5"),priceWithTax:n.getValueByMatchedKey(i,"\u7a0e\u8fbc\u4fa1\u683c"),place:n.getValueByMatchedKey(i,"\u5834\u6240"),url:n.getValueByMatchedKey(i,"URL"),note:n.getValueByMatchedKey(i,"\u88dc\u8db3\u60c5\u5831"),isDone:!1})}return e.appCacheService.setCachedJson("arisuGoodsList",u),u=yield e.injectStatuses(u),u})()}setItemStatus(e,o){var r=this;return d(function*(){if(yield r.init(),!r.storage)throw new Error("Failed to init storage");r.storage.set(e.toString(),{note:void 0,isDone:o})})()}injectStatuses(e){var o=this;return d(function*(){for(const r of e){const a=yield o.storage?.get(r.id.toString());r.isDone=!!a&&a.isDone}return e.sort((r,a)=>void 0===r.reservationStartDate?1:void 0===a.reservationStartDate?-1:r.reservationStartDate.localeCompare(a.reservationStartDate)),e})()}static getValueByMatchedKey(e,o){const r=o.toLowerCase(),a=Object.keys(e);for(const u of a)if(0===u.toLowerCase().indexOf(r)){let i=e[u];return void 0===i||""===i.trim()||"-"===i?void 0:e[u]}}}return n.GOODS_LIST_JSON_CACHE_EXPIRES=18e5,n.\u0275fac=function(e){return new(e||n)(t.LFG(F))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var Z=l(7009),M=l(3336),f=l(6338),k=l(6709),J=l(266),B=l(4006);function U(n,s){if(1&n&&(t.ynx(0),t.TgZ(1,"a",7)(2,"mat-icon"),t._uU(3,"link"),t.qZA()(),t._uU(4," \xa0 / "),t.BQk()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("href",e.item.url,t.LSH)}}function N(n,s){if(1&n&&(t.ynx(0),t._uU(1),t.ALo(2,"date"),t.BQk()),2&n){const e=t.oxw(2);t.xp6(1),t.hij(" \u4e88\u7d04\u958b\u59cb: ",t.xi3(2,1,e.item.reservationStartDate,"yyyy/MM/dd")," ")}}function Q(n,s){1&n&&(t.ynx(0),t._uU(1," / "),t.BQk())}function V(n,s){if(1&n&&(t.TgZ(0,"span",9),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.Q6J("matTooltip","\u88dc\u8db3: "+e.item.note),t.xp6(1),t.hij(" ",e.item.note," ")}}function j(n,s){if(1&n&&(t.TgZ(0,"span",4),t.YNc(1,N,3,4,"ng-container",5),t.YNc(2,Q,2,0,"ng-container",5),t.YNc(3,V,2,2,"span",8),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",void 0!==e.item.reservationStartDate&&!e.isPastDate(e.item.reservationStartDate)),t.xp6(1),t.Q6J("ngIf",void 0!==e.item.reservationStartDate&&!e.isPastDate(e.item.reservationStartDate)&&void 0!==e.item.note),t.xp6(1),t.Q6J("ngIf",void 0!==e.item.note)}}const K=function(n){return{"before-booking":n}};let q=(()=>{class n{constructor(){this.itemChange=new t.vpe}isPastDate(e){return new Date(e).getTime()<Date.now()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-goods-list-item"]],inputs:{item:"item"},outputs:{itemChange:"itemChange"},decls:10,vars:9,consts:[[3,"ngClass"],["matListItemIcon",""],[2,"float","left",3,"ngModel","ngModelChange"],["matListItemTitle",""],["matListItemLine",""],[4,"ngIf"],["matListItemLine","",4,"ngIf"],["target","_blank","rel","noopener",3,"href"],[3,"matTooltip",4,"ngIf"],[3,"matTooltip"]],template:function(e,o){1&e&&(t.TgZ(0,"mat-list-item",0)(1,"span",1)(2,"mat-checkbox",2),t.NdJ("ngModelChange",function(a){return o.item.isDone=a})("ngModelChange",function(){return o.itemChange.emit(o.item)}),t.qZA()(),t.TgZ(3,"span",3),t._uU(4),t.qZA(),t.TgZ(5,"span",4),t._uU(6),t.YNc(7,U,5,1,"ng-container",5),t._uU(8),t.qZA(),t.YNc(9,j,4,3,"span",6),t.qZA()),2&e&&(t.Q6J("ngClass",t.VKq(7,K,o.item.reservationStartDate&&!o.isPastDate(o.item.reservationStartDate))),t.xp6(2),t.Q6J("ngModel",o.item.isDone),t.xp6(2),t.hij(" ",o.item.name," "),t.xp6(2),t.hij(" [",o.item.category,"] \xa0 "),t.xp6(1),t.Q6J("ngIf",o.item.url),t.xp6(1),t.hij(" ",o.item.maker||"-"," "),t.xp6(1),t.Q6J("ngIf",void 0!==o.item.reservationStartDate&&!o.isPastDate(o.item.reservationStartDate)||void 0!==o.item.note))},dependencies:[p.mk,p.O5,k.oG,M.Hw,f.Tg,f.Yt,f.WW,f.sL,J.gM,B.JJ,B.On,p.uU],styles:["a[_ngcontent-%COMP%]{color:#4876a9}a[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.5rem;vertical-align:middle}.before-booking[_ngcontent-%COMP%]   .mat-mdc-list-item-title[_ngcontent-%COMP%], .before-booking[_ngcontent-%COMP%]   .mat-mdc-list-item-icon[_ngcontent-%COMP%]{opacity:.6}"]}),n})();function R(n,s){1&n&&(t.TgZ(0,"div",3)(1,"p"),t._uU(2,"\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059...\u3057\u3070\u3089\u304f\u304a\u5f85\u3061\u304f\u3060\u3055\u3044..."),t.qZA()())}function Y(n,s){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"app-goods-list-item",12),t.NdJ("itemChange",function(){const a=t.CHM(e).$implicit,u=t.oxw(2);return t.KtG(u.onItemStatusChange(a))}),t.qZA(),t.BQk()}if(2&n){const e=s.$implicit;t.xp6(1),t.Q6J("item",e)}}function z(n,s){if(1&n&&(t.TgZ(0,"div",8)(1,"mat-list",null,9)(3,"div",10),t._uU(4,"\u672a\u4ed5\u5206\u3051\u30fb\u672a\u6ce8\u6587"),t.qZA(),t.YNc(5,Y,2,1,"ng-container",11),t.qZA()()),2&n){const e=t.oxw();t.xp6(5),t.Q6J("ngForOf",e.items.undone)}}function H(n,s){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"app-goods-list-item",12),t.NdJ("itemChange",function(){const a=t.CHM(e).$implicit,u=t.oxw(2);return t.KtG(u.onItemStatusChange(a))}),t.qZA(),t.BQk()}if(2&n){const e=s.$implicit;t.xp6(1),t.Q6J("item",e)}}function W(n,s){if(1&n&&(t.TgZ(0,"div",8)(1,"mat-list",null,9)(3,"div",10),t._uU(4,"\u6ce8\u6587\u6e08\u30fb\u898b\u9001\u308a\u6e08"),t.qZA(),t.YNc(5,H,2,1,"ng-container",11),t.qZA()()),2&n){const e=t.oxw();t.xp6(5),t.Q6J("ngForOf",e.items.done)}}const $=[{path:"",component:(()=>{class n{constructor(e,o){this.goodsListService=e,this.snackBar=o,this.items=void 0}ngOnInit(){var e=this;return d(function*(){e.load()})()}load(){var e=this;return d(function*(){try{const o=yield e.goodsListService.getGoodsList();e.items={undone:o.filter(r=>!r.isDone),done:o.filter(r=>r.isDone)}}catch(o){e.snackBar.open(`\u30a8\u30e9\u30fc: ${o.message}`,"OK")}})()}onItemStatusChange(e){var o=this;return d(function*(){yield o.goodsListService.setItemStatus(e.id,e.isDone),o.load()})()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(G),t.Y36(Z.ux))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-goods-list-page"]],decls:31,vars:3,consts:[[1,"app-page-summary"],["class","app-card bordered",4,"ngIf"],["class","app-card bordered goods-list",4,"ngIf"],[1,"app-card","bordered"],["href","https://twitter.com/arisu_newsfeed","target","_blank","rel","noopener"],["routerLink","/arisu-calendar"],[1,"app-bottom-navigation"],["routerLink","/"],[1,"app-card","bordered","goods-list"],["goodsList",""],["mat-subheader",""],[4,"ngFor","ngForOf"],[3,"item","itemChange"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"h2"),t._uU(2,"\u3042\u308a\u3059\u30b0\u30c3\u30ba\u30ea\u30b9\u30c8 (\u03b1 ver.)"),t.qZA()(),t.YNc(3,R,3,0,"div",1),t.YNc(4,z,6,1,"div",2),t.YNc(5,W,6,1,"div",2),t.TgZ(6,"div",3)(7,"p")(8,"small"),t._uU(9," \u203b \u901f\u5831\u6027\u30fb\u6b63\u78ba\u6027\u30fb\u7db2\u7f85\u6027\u306a\u3069\u306f\u4fdd\u8a3c\u3067\u304d\u307e\u305b\u3093\u3002"),t._UZ(10,"br"),t._uU(11," \u307e\u305f\u3001\u4e88\u544a\u306a\u304f\u3001\u66f4\u65b0\u3092\u4f11\u6b62\u30fb\u7d42\u4e86\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u81ea\u5df1\u8cac\u4efb\u3067\u3054\u5229\u7528\u4e0b\u3055\u3044\u3002"),t._UZ(12,"br")(13,"br"),t._uU(14," \u203b \u5909\u66f4\u3057\u305f\u5185\u5bb9\u306f\u3001\u7aef\u672b\u5185\u306e\u307f\u306b\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002"),t._UZ(15,"br"),t._uU(16,"\u30d6\u30e9\u30a6\u30b6\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u6d88\u53bb\u306a\u3069\u3067\u6d88\u3048\u308b\u3053\u3068\u3082\u3042\u308b\u70ba\u3001\u304a\u307e\u3051\u7a0b\u5ea6\u306b\u3054\u6d3b\u7528\u304f\u3060\u3055\u3044\u3002"),t._UZ(17,"br")(18,"br"),t._uU(19," \u203b \u65b0\u7740\u60c5\u5831\u306e\u30c1\u30a7\u30c3\u30af\u306b\u306f\u3001"),t.TgZ(20,"a",4),t._uU(21,"@arisu_newsfeed"),t.qZA(),t._uU(22," \u3084\u3001"),t.TgZ(23,"a",5),t._uU(24,"\u3042\u308a\u3059\u30ab\u30ec\u30f3\u30c0\u30fc"),t.qZA(),t._uU(25," \u3082\u3054\u6d3b\u7528\u304f\u3060\u3055\u3044\u3002 "),t.qZA()()(),t.TgZ(26,"div",6)(27,"a",7)(28,"mat-icon"),t._uU(29,"navigate_before"),t.qZA(),t._uU(30," \xa0 \u30db\u30fc\u30e0\u3078"),t.qZA()()),2&e&&(t.xp6(3),t.Q6J("ngIf",void 0===o.items),t.xp6(1),t.Q6J("ngIf",void 0!==o.items),t.xp6(1),t.Q6J("ngIf",void 0!==o.items))},dependencies:[p.sg,p.O5,C.rH,M.Hw,f.i$,f.gs,q],styles:[".wbr[_ngcontent-%COMP%]{word-break:keep-all;overflow-wrap:anywhere}h3[_ngcontent-%COMP%]{font-size:1.1rem;margin-bottom:.75rem}h4[_ngcontent-%COMP%]{font-size:.9rem;margin:0}a[_ngcontent-%COMP%]:not([mat-stroked-button], [mat-raised-button])[_ngcontent-%COMP%]{word-wrap:break-word;color:#4d75c2;transition:all .2s ease-in-out}a[_ngcontent-%COMP%]:not([mat-stroked-button], [mat-raised-button])[_ngcontent-%COMP%]:hover{opacity:.7}a[_ngcontent-%COMP%]:not([mat-stroked-button], [mat-raised-button])[_ngcontent-%COMP%]   .app-card[_ngcontent-%COMP%]{color:#333}.app-card[_ngcontent-%COMP%]{box-sizing:border-box;width:90vw;max-width:800px;padding:1.2rem 0;position:relative;background-color:#fff;border-radius:10px}.app-card.bordered[_ngcontent-%COMP%]{border:1px solid #ccc;border-radius:4px;box-shadow:0 2px 4px #0003}.app-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.85rem}.app-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{font-size:.85rem;padding-left:2rem}.app-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{margin:.5rem 0 .8rem}.app-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:inline-block;margin-top:.2rem}.app-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:square}.app-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:.25rem 0 .5rem}.app-page-summary[_ngcontent-%COMP%]{width:80vw;text-align:center}.app-page-summary[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#555;font-size:1.5rem;font-weight:lighter;margin:0}.app-bottom-navigation[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#666;font-size:.8rem;text-decoration:none;margin-left:-1.5rem}.app-bottom-navigation[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#bddbfd;margin-bottom:0;vertical-align:middle}","[_nghost-%COMP%]{padding:1.5rem 1rem;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1.5rem}.app-card[_ngcontent-%COMP%]{padding:1rem 1rem .75rem}small[_ngcontent-%COMP%]{font-size:.8rem}@media screen and (max-width: 768px){.goods-list[_ngcontent-%COMP%]{padding-left:0;padding-right:0}}"]}),n})(),title:"\u3042\u308a\u3059\u30b0\u30c3\u30ba\u30ea\u30b9\u30c8"}];let X=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[C.Bz.forChild($),C.Bz]}),n})();var tt=l(1179);let et=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[p.ez,X,tt.m]}),n})()}}]);