"use strict";(self.webpackChunkarisucool=self.webpackChunkarisucool||[]).push([[493],{8493:(Y,y,g)=>{g.r(y),g.d(y,{GoodsListModule:()=>z});var _=g(6895),h=g(8996);function x(n,u,e,o,r,a,i){try{var s=n[a](i),c=s.value}catch(l){return void e(l)}s.done?u(c):Promise.resolve(c).then(o,r)}function d(n){return function(){var u=this,e=arguments;return new Promise(function(o,r){var a=n.apply(u,e);function i(c){x(a,o,r,i,s,"next",c)}function s(c){x(a,o,r,i,s,"throw",c)}i(void 0)})}}var t=g(4650);function v(n,u){if(!n)throw new Error(u)}const b=function(){var n=d(function*(u,e,o){return new Promise((r,a)=>{const c=u.transaction(e,"readonly").objectStore(e).count(String(o));c.onsuccess=()=>{r(0!==c.result)},c.onerror=()=>{a(c.error)}})});return function(e,o,r){return n.apply(this,arguments)}}(),E=function(){var n=d(function*(u,e,o,r){if(void 0!==r)return new Promise((a,i)=>{const s=u.transaction(e,"readwrite"),l=s.objectStore(e).put(r,String(o));s.oncomplete=()=>{a()},s.onabort=()=>{i(l.error?l.error:s.error)},s.onerror=()=>{i(l.error?l.error:s.error)}});yield M(u,e,o)});return function(e,o,r,a){return n.apply(this,arguments)}}(),M=function(){var n=d(function*(u,e,o){return new Promise((r,a)=>{const i=u.transaction(e,"readwrite"),c=i.objectStore(e).delete(String(o));i.oncomplete=()=>{r()},i.onabort=()=>{a(c.error?c.error:i.error)},i.onerror=()=>{a(c.error?c.error:i.error)}})});return function(e,o,r){return n.apply(this,arguments)}}(),I=function(){var n=d(function*(u,e){return new Promise((o,r)=>{const a=u.transaction(e,"readwrite"),s=a.objectStore(e).clear();a.oncomplete=()=>{o()},a.onabort=()=>{r(s.error?s.error:a.error)},a.onerror=()=>{r(s.error?s.error:a.error)}})});return function(e,o){return n.apply(this,arguments)}}(),S=({database:n,databaseName:u,tableName:e})=>{const o={delete:r=>M(n,e,r).then(()=>!0),get:r=>((n,u,e)=>new Promise((o,r)=>{const s=n.transaction(u,"readonly").objectStore(u).get(String(e));s.onsuccess=()=>{o(s.result)},s.onerror=()=>{r(s.error)}}))(n,e,r),has:r=>b(n,e,r),set:(r,a)=>E(n,e,r,a).then(()=>o),clear:()=>I(n,e),dropInstance:()=>((n,u)=>new Promise((e,o)=>{n.close();const r=indexedDB.deleteDatabase(u);r.onupgradeneeded=a=>{a.preventDefault(),e()},r.onblocked=()=>{o(r.error)},r.onerror=function(){o(r.error)},r.onsuccess=function(){e()}}))(n,u),close:()=>Promise.resolve().then(()=>{n.close()}),[Symbol.asyncIterator]:()=>((n,u)=>{const a=n.transaction(u,"readonly").objectStore(u).openCursor();return{next:()=>d(function*(){const{done:i,value:s}=yield(i=>new Promise((s,c)=>{i.onsuccess=()=>{const l=i.result;return s(l?{done:!1,value:l}:{done:!0})},i.onerror=()=>{c(i.error)}}))(a);if(!i){const c=s?.key,l=s?.value;return s?.continue(),{done:!1,value:[c,l]}}return{done:!0,value:void 0}})()}})(n,e),__debug__database__:n};return o},P=function(){var n=d(function*(u){var e;const{name:o,version:r,upgrade:a,...i}=u;v("string"==typeof o,"name should be string"),v("number"==typeof r,"version should be number");const s=null!==(e=i.tableName)&&void 0!==e?e:"kvs",c=yield(({name:n,version:u,tableName:e,onUpgrade:o})=>new Promise((r,a)=>{const i=indexedDB.open(n,u);i.onupgradeneeded=function(s){var c;const l=s.oldVersion,f=null!==(c=s.newVersion)&&void 0!==c?c:u,m=i.result;try{(!f||f<=1)&&m.createObjectStore(e)}catch(C){a(C)}m.onversionchange=()=>{m.close()},s.target.transaction.oncomplete=d(function*(){try{return yield o({oldVersion:l,newVersion:f,database:m}),r(m)}catch(C){return a(C)}})},i.onblocked=()=>{a(i.error)},i.onerror=function(){a(i.error)},i.onsuccess=function(){r(i.result)}}))({name:o,version:r,tableName:s,onUpgrade:({oldVersion:l,newVersion:f,database:m})=>{if(a)return a({kvs:S({database:m,tableName:s,databaseName:o}),oldVersion:l,newVersion:f})}});return S({database:c,tableName:s,databaseName:o})});return function(e){return n.apply(this,arguments)}}();let G=(()=>{class n{constructor(){this.CACHE_STORAGE_VERSION=1}init(){var e=this;return d(function*(){e.storage||(e.storage=yield P({name:"arisucoolCache",version:e.CACHE_STORAGE_VERSION}))})()}getCachedJson(e,o){var r=this;return d(function*(){if(yield r.init(),!r.storage)throw new Error("Storage not initialized");const a=yield r.storage.get(e);if(null===a)return;let i;try{i=JSON.parse(a)}catch{return}if(!i||!i.content||!i.createdAt)return;const s=(new Date).getTime();if(!(void 0!==o&&o<s-i.createdAt))return i.content;r.storage.delete(e)})()}setCachedJson(e,o){var r=this;return d(function*(){if(yield r.init(),!r.storage)throw new Error("Storage not initialized");const a=(new Date).getTime();"string"==typeof o&&(o=JSON.parse(o)),r.storage.set(e,JSON.stringify({content:o,createdAt:a}))})()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),F=(()=>{class n{constructor(e){this.appCacheService=e,this.GOODS_LIST_STORAGE_VERSION=1}init(){var e=this;return d(function*(){e.storage||(e.storage=yield P({name:"arisucoolGoodsListItemStatus",version:e.GOODS_LIST_STORAGE_VERSION}))})()}getGoodsList(){var e=this;return d(function*(){yield e.init();const o=yield e.appCacheService.getCachedJson("arisuGoodsList",n.GOODS_LIST_JSON_CACHE_EXPIRES);if(o)return yield e.injectStatuses(o);const r=yield fetch("https://script.google.com/macros/s/AKfycbxG8BUqph9H7kmUqA5hGBxWwENfySVfdQBjtuZJQWLhCuC7wYYG1d0Hmc-jGrFUwBvWbg/exec");if(!r.ok)throw new Error("Failed to fetch goods list");const a=yield r.json();let i=[];for(const s of a)i.push({id:n.getValueByMatchedKey(s,"id"),category:n.getValueByMatchedKey(s,"\u30ab\u30c6\u30b4\u30ea"),maker:n.getValueByMatchedKey(s,"\u30e1\u30fc\u30ab\u30fc"),reservationStartDate:n.getValueByMatchedKey(s,"\u4e88\u7d04\u958b\u59cb\u65e5"),name:n.getValueByMatchedKey(s,"\u5546\u54c1\u540d"),isArisuAlone:n.getValueByMatchedKey(s,"\u3042\u308a\u3059\u5358\u72ec\u304b"),releaseDate:n.getValueByMatchedKey(s,"\u767a\u58f2\u65e5"),priceWithTax:n.getValueByMatchedKey(s,"\u7a0e\u8fbc\u4fa1\u683c"),place:n.getValueByMatchedKey(s,"\u5834\u6240"),url:n.getValueByMatchedKey(s,"URL"),isDone:!1});return e.appCacheService.setCachedJson("arisuGoodsList",i),i=yield e.injectStatuses(i),i})()}setItemStatus(e,o){var r=this;return d(function*(){if(yield r.init(),!r.storage)throw new Error("Failed to init storage");r.storage.set(e.toString(),{note:void 0,isDone:o})})()}injectStatuses(e){var o=this;return d(function*(){for(const r of e){const a=yield o.storage?.get(r.id.toString());console.log(a),r.isDone=!!a&&a.isDone}return e})()}static getValueByMatchedKey(e,o){const r=o.toLowerCase(),a=Object.keys(e);for(const i of a)if(-1!==i.toLowerCase().indexOf(r))return console.log(o,i),e[i]}}return n.GOODS_LIST_JSON_CACHE_EXPIRES=18e5,n.\u0275fac=function(e){return new(e||n)(t.LFG(G))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var Z=g(7009),k=g(6709),U=g(3336),p=g(6338),O=g(4006);const B=function(n){return{past:n}};function J(n,u){if(1&n&&(t.ynx(0),t._uU(1," / \u4e88\u7d04\u958b\u59cb: "),t.TgZ(2,"span",13),t._uU(3),t.ALo(4,"date"),t.qZA(),t.BQk()),2&n){const e=t.oxw().$implicit,o=t.oxw();t.xp6(2),t.Q6J("ngClass",t.VKq(5,B,o.isPastDate(e.reservationStartDate))),t.xp6(1),t.hij(" ",t.xi3(4,2,e.reservationStartDate,"yyyy/MM/dd")," ")}}function j(n,u){if(1&n&&(t.ynx(0),t._uU(1," / \u4e88\u7d04\u958b\u59cb: "),t.TgZ(2,"a",14)(3,"mat-icon"),t._uU(4,"link"),t.qZA()(),t.BQk()),2&n){const e=t.oxw().$implicit;t.xp6(2),t.Q6J("href",e.url,t.LSH)}}function V(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"mat-list-item")(1,"span",8)(2,"mat-checkbox",9),t.NdJ("ngModelChange",function(r){const i=t.CHM(e).$implicit;return t.KtG(i.isDone=r)})("ngModelChange",function(){const a=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.onItemStatusChange(a))}),t.qZA()(),t.TgZ(3,"span",10),t._uU(4),t.qZA(),t.TgZ(5,"span",11),t._uU(6),t.YNc(7,J,5,7,"ng-container",12),t.YNc(8,j,5,1,"ng-container",12),t.qZA()()}if(2&n){const e=u.$implicit;t.xp6(2),t.Q6J("ngModel",e.isDone),t.xp6(2),t.hij(" ",e.name," "),t.xp6(2),t.AsE(" ",e.category," / ",e.maker||"-"," "),t.xp6(1),t.Q6J("ngIf",e.reservationStartDate),t.xp6(1),t.Q6J("ngIf",e.url)}}function K(n,u){if(1&n&&(t.ynx(0),t._uU(1," / \u4e88\u7d04\u958b\u59cb: "),t.TgZ(2,"span",13),t._uU(3),t.ALo(4,"date"),t.qZA(),t.BQk()),2&n){const e=t.oxw().$implicit,o=t.oxw();t.xp6(2),t.Q6J("ngClass",t.VKq(5,B,o.isPastDate(e.reservationStartDate))),t.xp6(1),t.hij(" ",t.xi3(4,2,e.reservationStartDate,"yyyy/MM/dd")," ")}}function q(n,u){if(1&n&&(t.ynx(0),t._uU(1," / \u4e88\u7d04\u958b\u59cb: "),t.TgZ(2,"a",14)(3,"mat-icon"),t._uU(4,"link"),t.qZA()(),t.BQk()),2&n){const e=t.oxw().$implicit;t.xp6(2),t.Q6J("href",e.url,t.LSH)}}function Q(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"mat-list-item")(1,"span",8)(2,"mat-checkbox",9),t.NdJ("ngModelChange",function(r){const i=t.CHM(e).$implicit;return t.KtG(i.isDone=r)})("ngModelChange",function(){const a=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.onItemStatusChange(a))}),t.qZA()(),t.TgZ(3,"span",10),t._uU(4),t.qZA(),t.TgZ(5,"span",11),t._uU(6),t.YNc(7,K,5,7,"ng-container",12),t.YNc(8,q,5,1,"ng-container",12),t.qZA()()}if(2&n){const e=u.$implicit;t.xp6(2),t.Q6J("ngModel",e.isDone),t.xp6(2),t.hij(" ",e.name," "),t.xp6(2),t.AsE(" ",e.category," / ",e.maker||"-"," "),t.xp6(1),t.Q6J("ngIf",e.reservationStartDate),t.xp6(1),t.Q6J("ngIf",e.url)}}const R=[{path:"",component:(()=>{class n{constructor(e,o){this.goodsListService=e,this.snackBar=o,this.items={undone:[],done:[]}}ngOnInit(){var e=this;return d(function*(){e.load()})()}load(){var e=this;return d(function*(){try{const o=yield e.goodsListService.getGoodsList();e.items.undone=o.filter(r=>!r.isDone),e.items.done=o.filter(r=>r.isDone)}catch(o){e.snackBar.open(`\u30a8\u30e9\u30fc: ${o.message}`,"OK")}})()}isDone(e){}isPastDate(e){return new Date(e).getTime()<Date.now()}onItemStatusChange(e){var o=this;return d(function*(){yield o.goodsListService.setItemStatus(e.id,e.isDone),o.load()})()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(F),t.Y36(Z.ux))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-goods-list-page"]],decls:31,vars:2,consts:[[1,"app-page-summary"],[1,"app-card","bordered","goods-list"],["goodsList",""],["mat-subheader",""],[4,"ngFor","ngForOf"],[1,"app-card","bordered"],[1,"app-bottom-navigation"],["routerLink","/"],["matListItemIcon",""],[2,"float","left",3,"ngModel","ngModelChange"],["matListItemTitle",""],["matListItemLine",""],[4,"ngIf"],[3,"ngClass"],["target","_blank","rel","noopener",3,"href"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"h2"),t._uU(2,"\u3042\u308a\u3059\u30b0\u30c3\u30ba\u30ea\u30b9\u30c8 (\u03b1 ver.)"),t.qZA()(),t.TgZ(3,"div",1)(4,"mat-list",null,2)(6,"div",3),t._uU(7,"\u672a\u4ed5\u5206\u3051\u30fb\u672a\u6ce8\u6587"),t.qZA(),t.YNc(8,V,9,6,"mat-list-item",4),t.qZA()(),t.TgZ(9,"div",1)(10,"mat-list",null,2)(12,"div",3),t._uU(13,"\u6ce8\u6587\u6e08\u30fb\u898b\u9001\u308a\u6e08"),t.qZA(),t.YNc(14,Q,9,6,"mat-list-item",4),t.qZA()(),t.TgZ(15,"div",5)(16,"p")(17,"small"),t._uU(18," \u203b \u901f\u5831\u6027\u30fb\u6b63\u78ba\u6027\u30fb\u7db2\u7f85\u6027\u306a\u3069\u306f\u4fdd\u8a3c\u3067\u304d\u307e\u305b\u3093\u3002"),t._UZ(19,"br"),t._uU(20," \u307e\u305f\u3001\u4e88\u544a\u306a\u304f\u3001\u66f4\u65b0\u3092\u4f11\u6b62\u30fb\u7d42\u4e86\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u81ea\u5df1\u8cac\u4efb\u3067\u3054\u5229\u7528\u4e0b\u3055\u3044\u3002"),t._UZ(21,"br")(22,"br"),t._uU(23," \u203b \u5909\u66f4\u3057\u305f\u5185\u5bb9\u306f\u3001\u7aef\u672b\u5185\u306e\u307f\u306b\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002"),t._UZ(24,"br"),t._uU(25,"\u30d6\u30e9\u30a6\u30b6\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u6d88\u53bb\u306a\u3069\u3067\u6d88\u3048\u308b\u3053\u3068\u3082\u3042\u308b\u70ba\u3001\u304a\u307e\u3051\u7a0b\u5ea6\u306b\u3054\u6d3b\u7528\u304f\u3060\u3055\u3044\u3002"),t.qZA()()(),t.TgZ(26,"div",6)(27,"a",7)(28,"mat-icon"),t._uU(29,"navigate_before"),t.qZA(),t._uU(30," \xa0 \u30db\u30fc\u30e0\u3078"),t.qZA()()),2&e&&(t.xp6(8),t.Q6J("ngForOf",o.items.undone),t.xp6(6),t.Q6J("ngForOf",o.items.done))},dependencies:[_.mk,_.sg,_.O5,h.rH,k.oG,U.Hw,p.i$,p.Tg,p.Yt,p.gs,p.WW,p.sL,O.JJ,O.On,_.uU],styles:[".wbr[_ngcontent-%COMP%]{word-break:keep-all;overflow-wrap:anywhere}h3[_ngcontent-%COMP%]{font-size:1.1rem;margin-bottom:.75rem}h4[_ngcontent-%COMP%]{font-size:.9rem;margin:0}a[_ngcontent-%COMP%]:not([mat-stroked-button], [mat-raised-button])[_ngcontent-%COMP%]{word-wrap:break-word;color:#4d75c2;transition:all .2s ease-in-out}a[_ngcontent-%COMP%]:not([mat-stroked-button], [mat-raised-button])[_ngcontent-%COMP%]:hover{opacity:.7}a[_ngcontent-%COMP%]:not([mat-stroked-button], [mat-raised-button])[_ngcontent-%COMP%]   .app-card[_ngcontent-%COMP%]{color:#333}.app-card[_ngcontent-%COMP%]{box-sizing:border-box;width:90vw;max-width:800px;padding:1.2rem 0;position:relative;background-color:#fff;border-radius:10px}.app-card.bordered[_ngcontent-%COMP%]{border:1px solid #ccc;border-radius:4px;box-shadow:0 2px 4px #0003}.app-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.85rem}.app-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{font-size:.85rem;padding-left:2rem}.app-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{margin:.5rem 0 .8rem}.app-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:inline-block;margin-top:.2rem}.app-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:square}.app-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:.25rem 0 .5rem}.app-page-summary[_ngcontent-%COMP%]{width:80vw;text-align:center}.app-page-summary[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#555;font-size:1.5rem;font-weight:lighter;margin:0}.app-bottom-navigation[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#666;font-size:.8rem;text-decoration:none;margin-left:-1.5rem}.app-bottom-navigation[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#bddbfd;margin-bottom:0;vertical-align:middle}","[_nghost-%COMP%]{padding:1.5rem 1rem;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1.5rem}.app-card[_ngcontent-%COMP%]{padding:1rem 1rem .75rem}.calendar-frame[_ngcontent-%COMP%]{width:95vw;max-width:1200px}small[_ngcontent-%COMP%]{font-size:.8rem}"]}),n})(),title:"\u3042\u308a\u3059\u30b0\u30c3\u30ba\u30ea\u30b9\u30c8"}];let H=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[h.Bz.forChild(R),h.Bz]}),n})();var N=g(6210);let z=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[_.ez,H,N.m]}),n})()}}]);