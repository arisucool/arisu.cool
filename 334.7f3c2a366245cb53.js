"use strict";(self.webpackChunkarisucool=self.webpackChunkarisucool||[]).push([[334],{1334:(W,y,g)=>{g.r(y),g.d(y,{GoodsListModule:()=>Y});var f=g(6895),h=g(8996);function v(n,u,e,o,r,a,i){try{var s=n[a](i),c=s.value}catch(l){return void e(l)}s.done?u(c):Promise.resolve(c).then(o,r)}function d(n){return function(){var u=this,e=arguments;return new Promise(function(o,r){var a=n.apply(u,e);function i(c){v(a,o,r,i,s,"next",c)}function s(c){v(a,o,r,i,s,"throw",c)}i(void 0)})}}var t=g(4650);function O(n,u){if(!n)throw new Error(u)}const b=function(){var n=d(function*(u,e,o){return new Promise((r,a)=>{const c=u.transaction(e,"readonly").objectStore(e).count(String(o));c.onsuccess=()=>{r(0!==c.result)},c.onerror=()=>{a(c.error)}})});return function(e,o,r){return n.apply(this,arguments)}}(),D=function(){var n=d(function*(u,e,o,r){if(void 0!==r)return new Promise((a,i)=>{const s=u.transaction(e,"readwrite"),l=s.objectStore(e).put(r,String(o));s.oncomplete=()=>{a()},s.onabort=()=>{i(l.error?l.error:s.error)},s.onerror=()=>{i(l.error?l.error:s.error)}});yield S(u,e,o)});return function(e,o,r,a){return n.apply(this,arguments)}}(),S=function(){var n=d(function*(u,e,o){return new Promise((r,a)=>{const i=u.transaction(e,"readwrite"),c=i.objectStore(e).delete(String(o));i.oncomplete=()=>{r()},i.onabort=()=>{a(c.error?c.error:i.error)},i.onerror=()=>{a(c.error?c.error:i.error)}})});return function(e,o,r){return n.apply(this,arguments)}}(),E=function(){var n=d(function*(u,e){return new Promise((o,r)=>{const a=u.transaction(e,"readwrite"),s=a.objectStore(e).clear();a.oncomplete=()=>{o()},a.onabort=()=>{r(s.error?s.error:a.error)},a.onerror=()=>{r(s.error?s.error:a.error)}})});return function(e,o){return n.apply(this,arguments)}}(),P=({database:n,databaseName:u,tableName:e})=>{const o={delete:r=>S(n,e,r).then(()=>!0),get:r=>((n,u,e)=>new Promise((o,r)=>{const s=n.transaction(u,"readonly").objectStore(u).get(String(e));s.onsuccess=()=>{o(s.result)},s.onerror=()=>{r(s.error)}}))(n,e,r),has:r=>b(n,e,r),set:(r,a)=>D(n,e,r,a).then(()=>o),clear:()=>E(n,e),dropInstance:()=>((n,u)=>new Promise((e,o)=>{n.close();const r=indexedDB.deleteDatabase(u);r.onupgradeneeded=a=>{a.preventDefault(),e()},r.onblocked=()=>{o(r.error)},r.onerror=function(){o(r.error)},r.onsuccess=function(){e()}}))(n,u),close:()=>Promise.resolve().then(()=>{n.close()}),[Symbol.asyncIterator]:()=>((n,u)=>{const a=n.transaction(u,"readonly").objectStore(u).openCursor();return{next:()=>d(function*(){const{done:i,value:s}=yield(i=>new Promise((s,c)=>{i.onsuccess=()=>{const l=i.result;return s(l?{done:!1,value:l}:{done:!0})},i.onerror=()=>{c(i.error)}}))(a);if(!i){const c=s?.key,l=s?.value;return s?.continue(),{done:!1,value:[c,l]}}return{done:!0,value:void 0}})()}})(n,e),__debug__database__:n};return o},M=function(){var n=d(function*(u){var e;const{name:o,version:r,upgrade:a,...i}=u;O("string"==typeof o,"name should be string"),O("number"==typeof r,"version should be number");const s=null!==(e=i.tableName)&&void 0!==e?e:"kvs",c=yield(({name:n,version:u,tableName:e,onUpgrade:o})=>new Promise((r,a)=>{const i=indexedDB.open(n,u);i.onupgradeneeded=function(s){var c;const l=s.oldVersion,_=null!==(c=s.newVersion)&&void 0!==c?c:u,m=i.result;try{(!_||_<=1)&&m.createObjectStore(e)}catch(C){a(C)}m.onversionchange=()=>{m.close()},s.target.transaction.oncomplete=d(function*(){try{return yield o({oldVersion:l,newVersion:_,database:m}),r(m)}catch(C){return a(C)}})},i.onblocked=()=>{a(i.error)},i.onerror=function(){a(i.error)},i.onsuccess=function(){r(i.result)}}))({name:o,version:r,tableName:s,onUpgrade:({oldVersion:l,newVersion:_,database:m})=>{if(a)return a({kvs:P({database:m,tableName:s,databaseName:o}),oldVersion:l,newVersion:_})}});return P({database:c,tableName:s,databaseName:o})});return function(e){return n.apply(this,arguments)}}();let G=(()=>{class n{constructor(){this.CACHE_STORAGE_VERSION=1}init(){var e=this;return d(function*(){e.storage||(e.storage=yield M({name:"arisucoolCache",version:e.CACHE_STORAGE_VERSION}))})()}getCachedJson(e,o){var r=this;return d(function*(){if(yield r.init(),!r.storage)throw new Error("Storage not initialized");const a=yield r.storage.get(e);if(null===a)return;let i;try{i=JSON.parse(a)}catch{return}if(!i||!i.content||!i.createdAt)return;const s=(new Date).getTime();if(!(void 0!==o&&o<s-i.createdAt))return i.content;r.storage.delete(e)})()}setCachedJson(e,o){var r=this;return d(function*(){if(yield r.init(),!r.storage)throw new Error("Storage not initialized");const a=(new Date).getTime();"string"==typeof o&&(o=JSON.parse(o)),r.storage.set(e,JSON.stringify({content:o,createdAt:a}))})()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),T=(()=>{class n{constructor(e){this.appCacheService=e,this.GOODS_LIST_STORAGE_VERSION=1}init(){var e=this;return d(function*(){e.storage||(e.storage=yield M({name:"arisucoolGoodsListItemStatus",version:e.GOODS_LIST_STORAGE_VERSION}))})()}getGoodsList(){var e=this;return d(function*(){yield e.init();const o=yield e.appCacheService.getCachedJson("arisuGoodsList",n.GOODS_LIST_JSON_CACHE_EXPIRES);if(o)return yield e.injectStatuses(o);const r=yield fetch("https://script.google.com/macros/s/AKfycbxG8BUqph9H7kmUqA5hGBxWwENfySVfdQBjtuZJQWLhCuC7wYYG1d0Hmc-jGrFUwBvWbg/exec");if(!r.ok)throw new Error("Failed to fetch goods list");const a=yield r.json();let i=[];for(const s of a)i.push({id:n.getValueByMatchedKey(s,"id"),category:n.getValueByMatchedKey(s,"\u30ab\u30c6\u30b4\u30ea"),maker:n.getValueByMatchedKey(s,"\u30e1\u30fc\u30ab\u30fc"),reservationStartDate:n.getValueByMatchedKey(s,"\u4e88\u7d04\u958b\u59cb\u65e5"),name:n.getValueByMatchedKey(s,"\u5546\u54c1\u540d"),isArisuAlone:n.getValueByMatchedKey(s,"\u3042\u308a\u3059\u5358\u72ec\u304b"),releaseDate:n.getValueByMatchedKey(s,"\u767a\u58f2\u65e5"),priceWithTax:n.getValueByMatchedKey(s,"\u7a0e\u8fbc\u4fa1\u683c"),place:n.getValueByMatchedKey(s,"\u5834\u6240"),url:n.getValueByMatchedKey(s,"URL"),isDone:!1});return e.appCacheService.setCachedJson("arisuGoodsList",i),i=yield e.injectStatuses(i),i})()}setItemStatus(e,o){var r=this;return d(function*(){if(yield r.init(),!r.storage)throw new Error("Failed to init storage");r.storage.set(e.toString(),{note:void 0,isDone:o})})()}injectStatuses(e){var o=this;return d(function*(){for(const r of e){const a=yield o.storage?.get(r.id.toString());console.log(a),r.isDone=!!a&&a.isDone}return e.sort((r,a)=>void 0===r.reservationStartDate?1:void 0===a.reservationStartDate?-1:r.reservationStartDate.localeCompare(a.reservationStartDate)),e})()}static getValueByMatchedKey(e,o){const r=o.toLowerCase(),a=Object.keys(e);for(const i of a)if(-1!==i.toLowerCase().indexOf(r))return console.log(o,i),e[i]}}return n.GOODS_LIST_JSON_CACHE_EXPIRES=18e5,n.\u0275fac=function(e){return new(e||n)(t.LFG(G))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var Z=g(7009),x=g(3336),p=g(6338),J=g(6709),B=g(4006);function k(n,u){if(1&n&&(t.ynx(0),t.TgZ(1,"a",6)(2,"mat-icon"),t._uU(3,"link"),t.qZA()(),t._uU(4," \xa0 / "),t.BQk()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("href",e.item.url,t.LSH)}}function U(n,u){if(1&n&&(t.TgZ(0,"span",3),t._uU(1),t.ALo(2,"date"),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" \u4e88\u7d04\u958b\u59cb: ",t.xi3(2,1,e.item.reservationStartDate,"yyyy/MM/dd")," ")}}let j=(()=>{class n{constructor(){this.itemChange=new t.vpe}isPastDate(e){const r=new Date(e).getTime()<Date.now();return console.log(e,r),r}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-goods-list-item"]],inputs:{item:"item"},outputs:{itemChange:"itemChange"},decls:10,vars:6,consts:[["matListItemIcon",""],[2,"float","left",3,"ngModel","ngModelChange"],["matListItemTitle",""],["matListItemLine",""],[4,"ngIf"],["matListItemLine","",4,"ngIf"],["target","_blank","rel","noopener",3,"href"]],template:function(e,o){1&e&&(t.TgZ(0,"mat-list-item")(1,"span",0)(2,"mat-checkbox",1),t.NdJ("ngModelChange",function(a){return o.item.isDone=a})("ngModelChange",function(){return o.itemChange.emit(o.item)}),t.qZA()(),t.TgZ(3,"span",2),t._uU(4),t.qZA(),t.TgZ(5,"span",3),t._uU(6),t.YNc(7,k,5,1,"ng-container",4),t._uU(8),t.qZA(),t.YNc(9,U,3,4,"span",5),t.qZA()),2&e&&(t.xp6(2),t.Q6J("ngModel",o.item.isDone),t.xp6(2),t.hij(" ",o.item.name," "),t.xp6(2),t.hij(" [",o.item.category,"] \xa0 "),t.xp6(1),t.Q6J("ngIf",o.item.url),t.xp6(1),t.hij(" ",o.item.maker||"-"," "),t.xp6(1),t.Q6J("ngIf",void 0!==o.item.reservationStartDate&&o.item.reservationStartDate.length>0&&!o.isPastDate(o.item.reservationStartDate)))},dependencies:[f.O5,J.oG,x.Hw,p.Tg,p.Yt,p.WW,p.sL,B.JJ,B.On,f.uU],styles:["a[_ngcontent-%COMP%]{color:#4876a9}a[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.5rem;vertical-align:middle}"]}),n})();function V(n,u){1&n&&(t.TgZ(0,"div",3)(1,"p"),t._uU(2,"\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059...\u3057\u3070\u3089\u304f\u304a\u5f85\u3061\u304f\u3060\u3055\u3044..."),t.qZA()())}function N(n,u){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"app-goods-list-item",10),t.NdJ("itemChange",function(){const a=t.CHM(e).$implicit,i=t.oxw(2);return t.KtG(i.onItemStatusChange(a))}),t.qZA(),t.BQk()}if(2&n){const e=u.$implicit;t.xp6(1),t.Q6J("item",e)}}function K(n,u){if(1&n&&(t.TgZ(0,"div",6)(1,"mat-list",null,7)(3,"div",8),t._uU(4,"\u672a\u4ed5\u5206\u3051\u30fb\u672a\u6ce8\u6587"),t.qZA(),t.YNc(5,N,2,1,"ng-container",9),t.qZA()()),2&n){const e=t.oxw();t.xp6(5),t.Q6J("ngForOf",e.items.undone)}}function R(n,u){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"app-goods-list-item",10),t.NdJ("itemChange",function(){const a=t.CHM(e).$implicit,i=t.oxw(2);return t.KtG(i.onItemStatusChange(a))}),t.qZA(),t.BQk()}if(2&n){const e=u.$implicit;t.xp6(1),t.Q6J("item",e)}}function z(n,u){if(1&n&&(t.TgZ(0,"div",6)(1,"mat-list",null,7)(3,"div",8),t._uU(4,"\u6ce8\u6587\u6e08\u30fb\u898b\u9001\u308a\u6e08"),t.qZA(),t.YNc(5,R,2,1,"ng-container",9),t.qZA()()),2&n){const e=t.oxw();t.xp6(5),t.Q6J("ngForOf",e.items.done)}}const Q=[{path:"",component:(()=>{class n{constructor(e,o){this.goodsListService=e,this.snackBar=o,this.items=void 0}ngOnInit(){var e=this;return d(function*(){e.load()})()}load(){var e=this;return d(function*(){try{const o=yield e.goodsListService.getGoodsList();e.items={undone:o.filter(r=>!r.isDone),done:o.filter(r=>r.isDone)}}catch(o){e.snackBar.open(`\u30a8\u30e9\u30fc: ${o.message}`,"OK")}})()}onItemStatusChange(e){var o=this;return d(function*(){yield o.goodsListService.setItemStatus(e.id,e.isDone),o.load()})()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(T),t.Y36(Z.ux))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-goods-list-page"]],decls:22,vars:3,consts:[[1,"app-page-summary"],["class","app-card bordered",4,"ngIf"],["class","app-card bordered goods-list","style","padding-left: 0.5rem",4,"ngIf"],[1,"app-card","bordered"],[1,"app-bottom-navigation"],["routerLink","/"],[1,"app-card","bordered","goods-list",2,"padding-left","0.5rem"],["goodsList",""],["mat-subheader",""],[4,"ngFor","ngForOf"],[3,"item","itemChange"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"h2"),t._uU(2,"\u3042\u308a\u3059\u30b0\u30c3\u30ba\u30ea\u30b9\u30c8 (\u03b1 ver.)"),t.qZA()(),t.YNc(3,V,3,0,"div",1),t.YNc(4,K,6,1,"div",2),t.YNc(5,z,6,1,"div",2),t.TgZ(6,"div",3)(7,"p")(8,"small"),t._uU(9," \u203b \u901f\u5831\u6027\u30fb\u6b63\u78ba\u6027\u30fb\u7db2\u7f85\u6027\u306a\u3069\u306f\u4fdd\u8a3c\u3067\u304d\u307e\u305b\u3093\u3002"),t._UZ(10,"br"),t._uU(11," \u307e\u305f\u3001\u4e88\u544a\u306a\u304f\u3001\u66f4\u65b0\u3092\u4f11\u6b62\u30fb\u7d42\u4e86\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u81ea\u5df1\u8cac\u4efb\u3067\u3054\u5229\u7528\u4e0b\u3055\u3044\u3002"),t._UZ(12,"br")(13,"br"),t._uU(14," \u203b \u5909\u66f4\u3057\u305f\u5185\u5bb9\u306f\u3001\u7aef\u672b\u5185\u306e\u307f\u306b\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002"),t._UZ(15,"br"),t._uU(16,"\u30d6\u30e9\u30a6\u30b6\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u6d88\u53bb\u306a\u3069\u3067\u6d88\u3048\u308b\u3053\u3068\u3082\u3042\u308b\u70ba\u3001\u304a\u307e\u3051\u7a0b\u5ea6\u306b\u3054\u6d3b\u7528\u304f\u3060\u3055\u3044\u3002"),t.qZA()()(),t.TgZ(17,"div",4)(18,"a",5)(19,"mat-icon"),t._uU(20,"navigate_before"),t.qZA(),t._uU(21," \xa0 \u30db\u30fc\u30e0\u3078"),t.qZA()()),2&e&&(t.xp6(3),t.Q6J("ngIf",void 0===o.items),t.xp6(1),t.Q6J("ngIf",void 0!==o.items),t.xp6(1),t.Q6J("ngIf",void 0!==o.items))},dependencies:[f.sg,f.O5,h.rH,x.Hw,p.i$,p.gs,j],styles:[".wbr[_ngcontent-%COMP%]{word-break:keep-all;overflow-wrap:anywhere}h3[_ngcontent-%COMP%]{font-size:1.1rem;margin-bottom:.75rem}h4[_ngcontent-%COMP%]{font-size:.9rem;margin:0}a[_ngcontent-%COMP%]:not([mat-stroked-button], [mat-raised-button])[_ngcontent-%COMP%]{word-wrap:break-word;color:#4d75c2;transition:all .2s ease-in-out}a[_ngcontent-%COMP%]:not([mat-stroked-button], [mat-raised-button])[_ngcontent-%COMP%]:hover{opacity:.7}a[_ngcontent-%COMP%]:not([mat-stroked-button], [mat-raised-button])[_ngcontent-%COMP%]   .app-card[_ngcontent-%COMP%]{color:#333}.app-card[_ngcontent-%COMP%]{box-sizing:border-box;width:90vw;max-width:800px;padding:1.2rem 0;position:relative;background-color:#fff;border-radius:10px}.app-card.bordered[_ngcontent-%COMP%]{border:1px solid #ccc;border-radius:4px;box-shadow:0 2px 4px #0003}.app-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.85rem}.app-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{font-size:.85rem;padding-left:2rem}.app-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{margin:.5rem 0 .8rem}.app-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:inline-block;margin-top:.2rem}.app-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:square}.app-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:.25rem 0 .5rem}.app-page-summary[_ngcontent-%COMP%]{width:80vw;text-align:center}.app-page-summary[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#555;font-size:1.5rem;font-weight:lighter;margin:0}.app-bottom-navigation[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#666;font-size:.8rem;text-decoration:none;margin-left:-1.5rem}.app-bottom-navigation[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#bddbfd;margin-bottom:0;vertical-align:middle}","[_nghost-%COMP%]{padding:1.5rem 1rem;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1.5rem}.app-card[_ngcontent-%COMP%]{padding:1rem 1rem .75rem}.calendar-frame[_ngcontent-%COMP%]{width:95vw;max-width:1200px}small[_ngcontent-%COMP%]{font-size:.8rem}"]}),n})(),title:"\u3042\u308a\u3059\u30b0\u30c3\u30ba\u30ea\u30b9\u30c8"}];let q=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[h.Bz.forChild(Q),h.Bz]}),n})();var H=g(6210);let Y=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[f.ez,q,H.m]}),n})()}}]);