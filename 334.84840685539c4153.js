"use strict";(self.webpackChunkarisucool=self.webpackChunkarisucool||[]).push([[334],{1334:(H,y,g)=>{g.r(y),g.d(y,{GoodsListModule:()=>q});var _=g(6895),h=g(8996);function v(n,u,t,o,r,a,i){try{var s=n[a](i),c=s.value}catch(l){return void t(l)}s.done?u(c):Promise.resolve(c).then(o,r)}function d(n){return function(){var u=this,t=arguments;return new Promise(function(o,r){var a=n.apply(u,t);function i(c){v(a,o,r,i,s,"next",c)}function s(c){v(a,o,r,i,s,"throw",c)}i(void 0)})}}var e=g(4650);function O(n,u){if(!n)throw new Error(u)}const b=function(){var n=d(function*(u,t,o){return new Promise((r,a)=>{const c=u.transaction(t,"readonly").objectStore(t).count(String(o));c.onsuccess=()=>{r(0!==c.result)},c.onerror=()=>{a(c.error)}})});return function(t,o,r){return n.apply(this,arguments)}}(),D=function(){var n=d(function*(u,t,o,r){if(void 0!==r)return new Promise((a,i)=>{const s=u.transaction(t,"readwrite"),l=s.objectStore(t).put(r,String(o));s.oncomplete=()=>{a()},s.onabort=()=>{i(l.error?l.error:s.error)},s.onerror=()=>{i(l.error?l.error:s.error)}});yield S(u,t,o)});return function(t,o,r,a){return n.apply(this,arguments)}}(),S=function(){var n=d(function*(u,t,o){return new Promise((r,a)=>{const i=u.transaction(t,"readwrite"),c=i.objectStore(t).delete(String(o));i.oncomplete=()=>{r()},i.onabort=()=>{a(c.error?c.error:i.error)},i.onerror=()=>{a(c.error?c.error:i.error)}})});return function(t,o,r){return n.apply(this,arguments)}}(),E=function(){var n=d(function*(u,t){return new Promise((o,r)=>{const a=u.transaction(t,"readwrite"),s=a.objectStore(t).clear();a.oncomplete=()=>{o()},a.onabort=()=>{r(s.error?s.error:a.error)},a.onerror=()=>{r(s.error?s.error:a.error)}})});return function(t,o){return n.apply(this,arguments)}}(),P=({database:n,databaseName:u,tableName:t})=>{const o={delete:r=>S(n,t,r).then(()=>!0),get:r=>((n,u,t)=>new Promise((o,r)=>{const s=n.transaction(u,"readonly").objectStore(u).get(String(t));s.onsuccess=()=>{o(s.result)},s.onerror=()=>{r(s.error)}}))(n,t,r),has:r=>b(n,t,r),set:(r,a)=>D(n,t,r,a).then(()=>o),clear:()=>E(n,t),dropInstance:()=>((n,u)=>new Promise((t,o)=>{n.close();const r=indexedDB.deleteDatabase(u);r.onupgradeneeded=a=>{a.preventDefault(),t()},r.onblocked=()=>{o(r.error)},r.onerror=function(){o(r.error)},r.onsuccess=function(){t()}}))(n,u),close:()=>Promise.resolve().then(()=>{n.close()}),[Symbol.asyncIterator]:()=>((n,u)=>{const a=n.transaction(u,"readonly").objectStore(u).openCursor();return{next:()=>d(function*(){const{done:i,value:s}=yield(i=>new Promise((s,c)=>{i.onsuccess=()=>{const l=i.result;return s(l?{done:!1,value:l}:{done:!0})},i.onerror=()=>{c(i.error)}}))(a);if(!i){const c=s?.key,l=s?.value;return s?.continue(),{done:!1,value:[c,l]}}return{done:!0,value:void 0}})()}})(n,t),__debug__database__:n};return o},M=function(){var n=d(function*(u){var t;const{name:o,version:r,upgrade:a,...i}=u;O("string"==typeof o,"name should be string"),O("number"==typeof r,"version should be number");const s=null!==(t=i.tableName)&&void 0!==t?t:"kvs",c=yield(({name:n,version:u,tableName:t,onUpgrade:o})=>new Promise((r,a)=>{const i=indexedDB.open(n,u);i.onupgradeneeded=function(s){var c;const l=s.oldVersion,f=null!==(c=s.newVersion)&&void 0!==c?c:u,m=i.result;try{(!f||f<=1)&&m.createObjectStore(t)}catch(C){a(C)}m.onversionchange=()=>{m.close()},s.target.transaction.oncomplete=d(function*(){try{return yield o({oldVersion:l,newVersion:f,database:m}),r(m)}catch(C){return a(C)}})},i.onblocked=()=>{a(i.error)},i.onerror=function(){a(i.error)},i.onsuccess=function(){r(i.result)}}))({name:o,version:r,tableName:s,onUpgrade:({oldVersion:l,newVersion:f,database:m})=>{if(a)return a({kvs:P({database:m,tableName:s,databaseName:o}),oldVersion:l,newVersion:f})}});return P({database:c,tableName:s,databaseName:o})});return function(t){return n.apply(this,arguments)}}();let G=(()=>{class n{constructor(){this.CACHE_STORAGE_VERSION=1}init(){var t=this;return d(function*(){t.storage||(t.storage=yield M({name:"arisucoolCache",version:t.CACHE_STORAGE_VERSION}))})()}getCachedJson(t,o){var r=this;return d(function*(){if(yield r.init(),!r.storage)throw new Error("Storage not initialized");const a=yield r.storage.get(t);if(null===a)return;let i;try{i=JSON.parse(a)}catch{return}if(!i||!i.content||!i.createdAt)return;const s=(new Date).getTime();if(!(void 0!==o&&o<s-i.createdAt))return i.content;r.storage.delete(t)})()}setCachedJson(t,o){var r=this;return d(function*(){if(yield r.init(),!r.storage)throw new Error("Storage not initialized");const a=(new Date).getTime();"string"==typeof o&&(o=JSON.parse(o)),r.storage.set(t,JSON.stringify({content:o,createdAt:a}))})()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),T=(()=>{class n{constructor(t){this.appCacheService=t,this.GOODS_LIST_STORAGE_VERSION=1}init(){var t=this;return d(function*(){t.storage||(t.storage=yield M({name:"arisucoolGoodsListItemStatus",version:t.GOODS_LIST_STORAGE_VERSION}))})()}getGoodsList(){var t=this;return d(function*(){yield t.init();const o=yield t.appCacheService.getCachedJson("arisuGoodsList",n.GOODS_LIST_JSON_CACHE_EXPIRES);if(o)return yield t.injectStatuses(o);const r=yield fetch("https://script.google.com/macros/s/AKfycbxG8BUqph9H7kmUqA5hGBxWwENfySVfdQBjtuZJQWLhCuC7wYYG1d0Hmc-jGrFUwBvWbg/exec");if(!r.ok)throw new Error("Failed to fetch goods list");const a=yield r.json();let i=[];for(const s of a)i.push({id:n.getValueByMatchedKey(s,"id"),category:n.getValueByMatchedKey(s,"\u30ab\u30c6\u30b4\u30ea"),maker:n.getValueByMatchedKey(s,"\u30e1\u30fc\u30ab\u30fc"),reservationStartDate:n.getValueByMatchedKey(s,"\u4e88\u7d04\u958b\u59cb\u65e5"),name:n.getValueByMatchedKey(s,"\u5546\u54c1\u540d"),isArisuAlone:n.getValueByMatchedKey(s,"\u3042\u308a\u3059\u5358\u72ec\u304b"),releaseDate:n.getValueByMatchedKey(s,"\u767a\u58f2\u65e5"),priceWithTax:n.getValueByMatchedKey(s,"\u7a0e\u8fbc\u4fa1\u683c"),place:n.getValueByMatchedKey(s,"\u5834\u6240"),url:n.getValueByMatchedKey(s,"URL"),isDone:!1});return t.appCacheService.setCachedJson("arisuGoodsList",i),i=yield t.injectStatuses(i),i})()}setItemStatus(t,o){var r=this;return d(function*(){if(yield r.init(),!r.storage)throw new Error("Failed to init storage");r.storage.set(t.toString(),{note:void 0,isDone:o})})()}injectStatuses(t){var o=this;return d(function*(){for(const r of t){const a=yield o.storage?.get(r.id.toString());console.log(a),r.isDone=!!a&&a.isDone}return t.sort((r,a)=>void 0===r.reservationStartDate?1:void 0===a.reservationStartDate?-1:r.reservationStartDate.localeCompare(a.reservationStartDate)),t})()}static getValueByMatchedKey(t,o){const r=o.toLowerCase(),a=Object.keys(t);for(const i of a)if(-1!==i.toLowerCase().indexOf(r))return console.log(o,i),t[i]}}return n.GOODS_LIST_JSON_CACHE_EXPIRES=18e5,n.\u0275fac=function(t){return new(t||n)(e.LFG(G))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var Z=g(7009),B=g(3336),p=g(6338),k=g(6709),x=g(4006);function J(n,u){if(1&n&&(e.ynx(0),e.TgZ(1,"a",6)(2,"mat-icon"),e._uU(3,"link"),e.qZA()(),e._uU(4," \xa0 / "),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("href",t.item.url,e.LSH)}}function U(n,u){if(1&n&&(e.TgZ(0,"span",3),e._uU(1),e.ALo(2,"date"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.hij(" \u4e88\u7d04\u958b\u59cb: ",e.xi3(2,1,t.item.reservationStartDate,"yyyy/MM/dd")," ")}}let j=(()=>{class n{constructor(){this.itemChange=new e.vpe}isPastDate(t){const r=new Date(t).getTime()<Date.now();return console.log(t,r),r}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-goods-list-item"]],inputs:{item:"item"},outputs:{itemChange:"itemChange"},decls:10,vars:6,consts:[["matListItemIcon",""],[2,"float","left",3,"ngModel","ngModelChange"],["matListItemTitle",""],["matListItemLine",""],[4,"ngIf"],["matListItemLine","",4,"ngIf"],["target","_blank","rel","noopener",3,"href"]],template:function(t,o){1&t&&(e.TgZ(0,"mat-list-item")(1,"span",0)(2,"mat-checkbox",1),e.NdJ("ngModelChange",function(a){return o.item.isDone=a})("ngModelChange",function(){return o.itemChange.emit(o.item)}),e.qZA()(),e.TgZ(3,"span",2),e._uU(4),e.qZA(),e.TgZ(5,"span",3),e._uU(6),e.YNc(7,J,5,1,"ng-container",4),e._uU(8),e.qZA(),e.YNc(9,U,3,4,"span",5),e.qZA()),2&t&&(e.xp6(2),e.Q6J("ngModel",o.item.isDone),e.xp6(2),e.hij(" ",o.item.name," "),e.xp6(2),e.hij(" [",o.item.category,"] \xa0 "),e.xp6(1),e.Q6J("ngIf",o.item.url),e.xp6(1),e.hij(" ",o.item.maker||"-"," "),e.xp6(1),e.Q6J("ngIf",void 0!==o.item.reservationStartDate&&o.item.reservationStartDate.length>0&&!o.isPastDate(o.item.reservationStartDate)))},dependencies:[_.O5,k.oG,B.Hw,p.Tg,p.Yt,p.WW,p.sL,x.JJ,x.On,_.uU],styles:["a[_ngcontent-%COMP%]{color:#4876a9}a[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.5rem;vertical-align:middle}"]}),n})();function V(n,u){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"app-goods-list-item",8),e.NdJ("itemChange",function(){const a=e.CHM(t).$implicit,i=e.oxw();return e.KtG(i.onItemStatusChange(a))}),e.qZA(),e.BQk()}if(2&n){const t=u.$implicit;e.xp6(1),e.Q6J("item",t)}}function K(n,u){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"app-goods-list-item",8),e.NdJ("itemChange",function(){const a=e.CHM(t).$implicit,i=e.oxw();return e.KtG(i.onItemStatusChange(a))}),e.qZA(),e.BQk()}if(2&n){const t=u.$implicit;e.xp6(1),e.Q6J("item",t)}}const R=[{path:"",component:(()=>{class n{constructor(t,o){this.goodsListService=t,this.snackBar=o,this.items={undone:[],done:[]}}ngOnInit(){var t=this;return d(function*(){t.load()})()}load(){var t=this;return d(function*(){try{const o=yield t.goodsListService.getGoodsList();t.items.undone=o.filter(r=>!r.isDone),t.items.done=o.filter(r=>r.isDone)}catch(o){t.snackBar.open(`\u30a8\u30e9\u30fc: ${o.message}`,"OK")}})()}onItemStatusChange(t){var o=this;return d(function*(){yield o.goodsListService.setItemStatus(t.id,t.isDone),o.load()})()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(T),e.Y36(Z.ux))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-goods-list-page"]],decls:31,vars:2,consts:[[1,"app-page-summary"],[1,"app-card","bordered","goods-list",2,"padding-left","0.5rem"],["goodsList",""],["mat-subheader",""],[4,"ngFor","ngForOf"],[1,"app-card","bordered"],[1,"app-bottom-navigation"],["routerLink","/"],[3,"item","itemChange"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"h2"),e._uU(2,"\u3042\u308a\u3059\u30b0\u30c3\u30ba\u30ea\u30b9\u30c8 (\u03b1 ver.)"),e.qZA()(),e.TgZ(3,"div",1)(4,"mat-list",null,2)(6,"div",3),e._uU(7,"\u672a\u4ed5\u5206\u3051\u30fb\u672a\u6ce8\u6587"),e.qZA(),e.YNc(8,V,2,1,"ng-container",4),e.qZA()(),e.TgZ(9,"div",1)(10,"mat-list",null,2)(12,"div",3),e._uU(13,"\u6ce8\u6587\u6e08\u30fb\u898b\u9001\u308a\u6e08"),e.qZA(),e.YNc(14,K,2,1,"ng-container",4),e.qZA()(),e.TgZ(15,"div",5)(16,"p")(17,"small"),e._uU(18," \u203b \u901f\u5831\u6027\u30fb\u6b63\u78ba\u6027\u30fb\u7db2\u7f85\u6027\u306a\u3069\u306f\u4fdd\u8a3c\u3067\u304d\u307e\u305b\u3093\u3002"),e._UZ(19,"br"),e._uU(20," \u307e\u305f\u3001\u4e88\u544a\u306a\u304f\u3001\u66f4\u65b0\u3092\u4f11\u6b62\u30fb\u7d42\u4e86\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u81ea\u5df1\u8cac\u4efb\u3067\u3054\u5229\u7528\u4e0b\u3055\u3044\u3002"),e._UZ(21,"br")(22,"br"),e._uU(23," \u203b \u5909\u66f4\u3057\u305f\u5185\u5bb9\u306f\u3001\u7aef\u672b\u5185\u306e\u307f\u306b\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002"),e._UZ(24,"br"),e._uU(25,"\u30d6\u30e9\u30a6\u30b6\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u6d88\u53bb\u306a\u3069\u3067\u6d88\u3048\u308b\u3053\u3068\u3082\u3042\u308b\u70ba\u3001\u304a\u307e\u3051\u7a0b\u5ea6\u306b\u3054\u6d3b\u7528\u304f\u3060\u3055\u3044\u3002"),e.qZA()()(),e.TgZ(26,"div",6)(27,"a",7)(28,"mat-icon"),e._uU(29,"navigate_before"),e.qZA(),e._uU(30," \xa0 \u30db\u30fc\u30e0\u3078"),e.qZA()()),2&t&&(e.xp6(8),e.Q6J("ngForOf",o.items.undone),e.xp6(6),e.Q6J("ngForOf",o.items.done))},dependencies:[_.sg,h.rH,B.Hw,p.i$,p.gs,j],styles:[".wbr[_ngcontent-%COMP%]{word-break:keep-all;overflow-wrap:anywhere}h3[_ngcontent-%COMP%]{font-size:1.1rem;margin-bottom:.75rem}h4[_ngcontent-%COMP%]{font-size:.9rem;margin:0}a[_ngcontent-%COMP%]:not([mat-stroked-button], [mat-raised-button])[_ngcontent-%COMP%]{word-wrap:break-word;color:#4d75c2;transition:all .2s ease-in-out}a[_ngcontent-%COMP%]:not([mat-stroked-button], [mat-raised-button])[_ngcontent-%COMP%]:hover{opacity:.7}a[_ngcontent-%COMP%]:not([mat-stroked-button], [mat-raised-button])[_ngcontent-%COMP%]   .app-card[_ngcontent-%COMP%]{color:#333}.app-card[_ngcontent-%COMP%]{box-sizing:border-box;width:90vw;max-width:800px;padding:1.2rem 0;position:relative;background-color:#fff;border-radius:10px}.app-card.bordered[_ngcontent-%COMP%]{border:1px solid #ccc;border-radius:4px;box-shadow:0 2px 4px #0003}.app-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.85rem}.app-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{font-size:.85rem;padding-left:2rem}.app-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{margin:.5rem 0 .8rem}.app-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:inline-block;margin-top:.2rem}.app-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:square}.app-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:.25rem 0 .5rem}.app-page-summary[_ngcontent-%COMP%]{width:80vw;text-align:center}.app-page-summary[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#555;font-size:1.5rem;font-weight:lighter;margin:0}.app-bottom-navigation[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#666;font-size:.8rem;text-decoration:none;margin-left:-1.5rem}.app-bottom-navigation[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#bddbfd;margin-bottom:0;vertical-align:middle}","[_nghost-%COMP%]{padding:1.5rem 1rem;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1.5rem}.app-card[_ngcontent-%COMP%]{padding:1rem 1rem .75rem}.calendar-frame[_ngcontent-%COMP%]{width:95vw;max-width:1200px}small[_ngcontent-%COMP%]{font-size:.8rem}"]}),n})(),title:"\u3042\u308a\u3059\u30b0\u30c3\u30ba\u30ea\u30b9\u30c8"}];let z=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[h.Bz.forChild(R),h.Bz]}),n})();var N=g(6210);let q=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[_.ez,z,N.m]}),n})()}}]);